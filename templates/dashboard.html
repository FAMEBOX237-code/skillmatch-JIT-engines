<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard • SkillMatch+</title>
    <link rel="stylesheet" href="../static/css/global.css">
    <link rel="stylesheet" href="../static/css/header-footer.css">
    <link rel="stylesheet" href="../static/css/messages.css">
    <link rel="stylesheet" href="../static/css/dashboard.css"> 
    <link rel="stylesheet" href="../static/css/modals.css"> 
    <link rel="stylesheet" href="../static/css/messages.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>


    <!-- LOGGED-IN HEADER -->
    <header class="main-header">
        <div class="container">
            <div class="logo">
                <h2><i class="fas fa-seedling"></i> SkillMatch+</h2>
            </div>
            <nav class="main-nav">
                <a href="dashboard.html" class="active">Dashboard</a>
                <a href="/skillfund">SkillFund</a>
            </nav>
            <div class="header-right">
                <div class="notification">
                    <i class="fas fa-bell"></i>
                    <span class="badge">3</span>
                </div>
                <div class="profile-dropdown" tabindex="0">
                    <img src="../static/images/avatar.png" alt="Profile" class="profile-pic">
                    <i class="fas fa-caret-down"></i>
                    <div class="dropdown-menu">
                        <a href="/profile">My Profile</a>
                        <a href="about.html">About Us</a>
                        <a href="/settings">Settings</a>
                        <a href="/logout">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

{% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-containers">
          {% for category, message in messages %}
            <div class="flash-messages {{ category }}">
                {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}


<!-- DASHBOARD WELCOME HERO -->
<section class="dashboard-welcome">
    <div class="container">
        
            
            <div class="welcome-text">
                <h1 class="welcome-title">
                    Welcome back, <span class="user-name">{{session.user_name}}</span>!
                </h1>
                <p class="welcome-subtitle">
                    Ready to trade skills, fund ideas, or find your next collaborator?
                </p>

                <div class="welcome-actions">
                    <button class="btn-primary" data-open-modal="createPostModal">
                        <i class="fas fa-plus"></i> Create New Post
                    </button>

                    <a href="/skillfund" class="btn-secondary">
                        <i class="fas fa-lightbulb"></i> Post a SkillFund Idea
                    </a>
                </div>

                <div class="welcome-stats">
                    <div class="stat">
                        <h3>{{ new_posts_today }}</h3>
                        <p>New Posts<br> Today</p>
                    </div>
                    <div class="stat">
                        <h3>{{ my_posts }}</h3>
                        <p>my personal<br> Posts</p>
                    </div>
                </div>
            </div>
    </div>
    <div class="wave-divider"></div>
</section>





<!-- MAIN CONTENT: POSTS FEED + SIDEBAR -->
<section class="dashboard-main">
    <div class="container">
        <div class="dashboard-grid">

    
            <div class="posts-feed">
                <div class="feed-header">
                    <h2>Post Feeds</h2>
                    <form method="GET" action="/dashboard">
                        <!-- Preserve existing filters -->
                        <input type="hidden" name="search" value="{{ request.args.get('search', '') }}">

                        {% for skill_id in selected_skills %}
                            <input type="hidden" name="skills" value="{{ skill_id }}">
                        {% endfor %}

                        {% if request.args.get('type') %}
                            <input type="hidden" name="type" value="{{ request.args.get('type') }}">
                        {% endif %}

                        {% if request.args.get('min_rating') %}
                            <input type="hidden" name="min_rating" value="{{ request.args.get('min_rating') }}">
                        {% endif %}

                        <!-- SORT SELECT -->
                        <select
                            class="sort-select"
                            name="sort"
                            onchange="this.form.submit()"
                        >
                            <option value="recent"
                                {% if request.args.get('sort', 'recent') == 'recent' %}selected{% endif %}
                            >
                                Most Recent
                            </option>

                            <option value="rating_desc"
                                {% if request.args.get('sort') == 'rating_desc' %}selected{% endif %}
                            >
                                Highest Rated
                            </option>

                            <option value="rating_asc"
                                {% if request.args.get('sort') == 'rating_asc' %}selected{% endif %}
                            >
                                Lowest Rated
                            </option>
                        </select>
                    </form>
                </div>

                <!-- POST CARD 1 – REQUEST -->
                {% for post in posts %}
                <article class="post-card {{ post.post_type }}">

                    <div class="post-header">
                        <img src="{{ post.profile_picture or '/static/images/avatar.png' }}" 
                            class="user-avatar">

                        <div class="user-info">
                            <h4>
                                {{ post.full_name }}
                                <span class="post-time">
                                    {{ post.created_at| time_since }}
                                </span>
                            </h4>
                            <div class="rating">
                    <i class="fas fa-star"></i> 4.9
                            </div>
                        </div>

                    <span class="post-type {{ post.post_type }}">
                    {{ post.post_type |capitalize }} 
                            
                    </span>
                    </div>

                    <div class="post-content">
                        <h3>{{ post.title }}</h3>
                        <p>{{ post.description }}</p>

                        <div class="skills-tags">
                            {% for skill in post.skills %}
                                <span class="tag">{{ skill.name }}</span>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="post-footer">
                        <form action="/posts/{{ post.id }}/interest" method="POST">
                        <button class="btn-interested">
                <i class="fas fa-check"></i> I'm Interested
                        </button>
                    </form>

                        <button class="btn-message">
                    <i class="fas fa-comment"></i> Message
                        </button>

                        <button class="btn-report" data-open-modal="reportPostModal">
                    <i class="fas fa-flag"></i>
                        </button>
                    </div>

                </article>
                {% else %}
                <p>No posts yet. Be the first to create one!</p>
                {% endfor %}
                            
                <!-- More posts will go here -->
            </div>

            <!-- FILTERS SIDEBAR (RIGHT SIDE) -->
<aside class="filters-sidebar">
    <form action="/dashboard" method="GET">
    <div class="filters-card">
        <h3 class="filters-title">
            <i class="fas fa-sliders-h"></i> Filter Feed
        </h3>

        <!-- Search Bar -->
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="Search posts, skills, users..." name="search" value="{{ request.args.get('search','')}}" class="search-input">
        </div>

        <!-- Post Type Filter -->
        <div class="filter-group">
            <h4>Post Type</h4>
            <label class="filter-option">
                <input type="checkbox" name="type" value="request" {% if request.args.get('type') == 'request' %}checked{% endif %}> <span class="type request">Requests</span>
            </label>
            <label class="filter-option">
                <input type="checkbox" name="type" value="offer" {% if request.args.get('type') == 'offer' %}checked{% endif %}> <span class="type offer">Offers</span>
            </label>
        </div>

        <!-- Skill Categories -->
        <div class="filter-group">
            <h4>Skill Categories</h4>
            <select class="skills-select" name="skills" multiple size="6">
                {% for skill in skills%}
                    <option value="{{skill.id}}" 
                    {% if skill.id|string in selected_skills %}selected{% endif%}>
                        {{ skill.name }}
                    </option>
                {% endfor %}
                </select>
                
                
        </div>

        <!-- Availability / Level -->
        <div class="filter-group">
            <h4>User Level</h4>
            <label class="filter-option">
                <input type="radio" name="level"> All Levels
            </label>
            <label class="filter-option">
                <input type="radio" name="level"> Beginner Friendly
            </label>
            <label class="filter-option">
                <input type="radio" name="level"> Intermediate & Above
            </label>
        </div>

        <!-- Rating Filter -->
         <!-- Rating Filter -->
        <div class="filter-group">
    <h4>Minimum Rating</h4>

    <div class="rating-filter">
            <input
                type="range"
                name="min_rating"
                min="0"
                max="5"
                step="0.5"
                value="{{ request.args.get('min_rating', 0) }}"
                class="rating-slider"
                id="ratingSlider"
            >

            <span class="rating-value" id="ratingValue">
                {{ request.args.get('min_rating', 0) }} +
            </span>
        </div>
    </div>


        <!-- Apply / Reset -->
        <div class="filter-actions">
            <button type="submit"class="btn-apply">Apply Filters</button>
            <a href="/dashboard" class="btn-reset">Reset All</a>
        </div>
    </div>
    </form>
</aside>

        </div>
    </div>
</section>


    
    

    <!-- FOOTER -->
    <footer class="main-footer">
        <div class="container footer-container">
            <div class="footer-links">
                <a href="/about">About Us</a>|
                <a href="/contact">Contact</a>|
                <a href="/terms">Terms</a>|
                <a href="/privacy">Privacy Policy</a>
            </div>
            <div class="footer-bottom">
                <p>© 2025 SkillFund. All rights reserved.</p>
            </div>
        </div>
    </footer>
    





    <!-- CREATE NEW POST MODAL -->
<div id="createPostModal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>Create New Post</h2>
        <form id="createPostForm" action="/create-post" method="POST">
            <div class="form-group">
                <label>Post Type:</label>
                <div class="radio-group">
                    <label><input type="radio" name="post_type" value="offer" checked> Offer a Skill</label>
                    <label><input type="radio" name="post_type" value="request"> Request Help</label>
                </div>
            </div>
            <div class="form-group">
                <label for="title">Title:</label>
                <input type="text" id="title" name="title" placeholder="e.g., 'Need help with Python assignment'" required>
            </div>
            <div class="form-group">
                <label for="description">Description:</label>
                <textarea id="description" name = "description" placeholder="Briefly describe what you offer or need help with. You have a limit of 128 characters" maxlength="128" required></textarea>
            </div>
            <div class="form-group">
                <label for="category">Skill Category:</label>
            <select class="skills-select" name="skills[]" multiple required>
                {% for skill in skills%}
                    <option value="{{skill.id}}">
                        {{ skill.name }}
                    </option>
                {% endfor %}
                </select>
            <div class="modal-actions">
                <button type="submit" class="btn-apply">Submit Post</button>
                <!-- <button type="button" class="btn-reset close-modal">Cancel</button> -->
            </div>
        </form>
    </div>
</div>







<!-- REPORT POST MODAL -->
<div id="reportPostModal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>

        <h2>Report Post</h2>
        <p class="modal-info">
            Help us keep SkillMatch+ safe. Tell us why you are reporting this post.
        </p>

        <form id="reportPostForm">
            <div class="form-group">
                <label for="reportReason">Reason</label>
                <select id="reportReason" name="reason" required>
                    <option value="">Select a reason</option>
                    <option value="spam">Spam or misleading</option>
                    <option value="inappropriate">Inappropriate content</option>
                    <option value="scam">Scam or fraud</option>
                    <option value="harassment">Harassment or abuse</option>
                    <option value="other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label for="reportMessage">Additional details (optional)</label>
                <textarea id="reportMessage" name="message"
                          placeholder="Provide more information if necessary..."></textarea>
            </div>

            <div class="modal-actions">
                <button type="submit" class="btn-apply">Submit Report</button>
                <!-- <button type="button" class="btn-reset close-modal">Cancel</button> -->
            </div>
        </form>
    </div>
</div>


<script src="../static/js/modals.js"></script>
</body>
</html>